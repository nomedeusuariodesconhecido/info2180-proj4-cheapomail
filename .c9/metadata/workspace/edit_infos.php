{"filter":false,"title":"edit_infos.php","tooltip":"/edit_infos.php","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":159,"column":7},"action":"insert","lines":["<?php","include('config.php');","?>","<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">","<html xmlns=\"http://www.w3.org/1999/xhtml\">","    <head>","        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />","        <link href=\"<?php echo $design; ?>/style.css\" rel=\"stylesheet\" title=\"Style\" />","        <title>Edit my personnal informations</title>","    </head>","    <body>","    \t<div class=\"header\">","        \t<a href=\"<?php echo $url_home; ?>\"><img src=\"<?php echo $design; ?>/images/logo.png\" alt=\"Members Area\" /></a>","\t    </div>","<?php","//We check if the user is logged","if(isset($_SESSION['username']))","{","\t//We check if the form has been sent","\tif(isset($_POST['username'], $_POST['password'], $_POST['passverif'], $_POST['email'], $_POST['avatar']))","\t{","\t\t//We remove slashes depending on the configuration","\t\tif(get_magic_quotes_gpc())","\t\t{","\t\t\t$_POST['username'] = stripslashes($_POST['username']);","\t\t\t$_POST['password'] = stripslashes($_POST['password']);","\t\t\t$_POST['passverif'] = stripslashes($_POST['passverif']);","\t\t\t$_POST['email'] = stripslashes($_POST['email']);","\t\t\t$_POST['avatar'] = stripslashes($_POST['avatar']);","\t\t}","\t\t//We check if the two passwords are identical","\t\tif($_POST['password']==$_POST['passverif'])","\t\t{","\t\t\t//We check if the password has 6 or more characters","\t\t\tif(strlen($_POST['password'])>=6)","\t\t\t{","\t\t\t\t//We check if the email form is valid","\t\t\t\tif(preg_match('#^(([a-z0-9!\\#$%&\\\\\\'*+/=?^_`{|}~-]+\\.?)*[a-z0-9!\\#$%&\\\\\\'*+/=?^_`{|}~-]+)@(([a-z0-9-_]+\\.?)*[a-z0-9-_]+)\\.[a-z]{2,}$#i',$_POST['email']))","\t\t\t\t{","\t\t\t\t\t//We protect the variables","\t\t\t\t\t$username = mysql_real_escape_string($_POST['username']);","\t\t\t\t\t$password = mysql_real_escape_string($_POST['password']);","\t\t\t\t\t$email = mysql_real_escape_string($_POST['email']);","\t\t\t\t\t$avatar = mysql_real_escape_string($_POST['avatar']);","\t\t\t\t\t//We check if there is no other user using the same username","\t\t\t\t\t$dn = mysql_fetch_array(mysql_query('select count(*) as nb from users where username=\"'.$username.'\"'));","\t\t\t\t\t//We check if the username changed and if it is available","\t\t\t\t\tif($dn['nb']==0 or $_POST['username']==$_SESSION['username'])","\t\t\t\t\t{","\t\t\t\t\t\t//We edit the user informations","\t\t\t\t\t\tif(mysql_query('update users set username=\"'.$username.'\", password=\"'.$password.'\", email=\"'.$email.'\", avatar=\"'.$avatar.'\" where id=\"'.mysql_real_escape_string($_SESSION['userid']).'\"'))","\t\t\t\t\t\t{","\t\t\t\t\t\t\t//We dont display the form","\t\t\t\t\t\t\t$form = false;","\t\t\t\t\t\t\t//We delete the old sessions so the user need to log again","\t\t\t\t\t\t\tunset($_SESSION['username'], $_SESSION['userid']);","?>","<div class=\"message\">Your informations have successfuly been updated. You need to log again.<br />","<a href=\"connexion.php\">Log in</a></div>","<?php","\t\t\t\t\t\t}","\t\t\t\t\t\telse","\t\t\t\t\t\t{","\t\t\t\t\t\t\t//Otherwise, we say that an error occured","\t\t\t\t\t\t\t$form = true;","\t\t\t\t\t\t\t$message = 'An error occurred while updating your informations.';","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\telse","\t\t\t\t\t{","\t\t\t\t\t\t//Otherwise, we say the username is not available","\t\t\t\t\t\t$form = true;","\t\t\t\t\t\t$message = 'The username you want to use is not available, please choose another one.';","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\telse","\t\t\t\t{","\t\t\t\t\t//Otherwise, we say the email is not valid","\t\t\t\t\t$form = true;","\t\t\t\t\t$message = 'The email you entered is not valid.';","\t\t\t\t}","\t\t\t}","\t\t\telse","\t\t\t{","\t\t\t\t//Otherwise, we say the password is too short","\t\t\t\t$form = true;","\t\t\t\t$message = 'Your password must contain at least 6 characters.';","\t\t\t}","\t\t}","\t\telse","\t\t{","\t\t\t//Otherwise, we say the passwords are not identical","\t\t\t$form = true;","\t\t\t$message = 'The passwords you entered are not identical.';","\t\t}","\t}","\telse","\t{","\t\t$form = true;","\t}","\tif($form)","\t{","\t\t//We display a message if necessary","\t\tif(isset($message))","\t\t{","\t\t\techo '<strong>'.$message.'</strong>';","\t\t}","\t\t//If the form has already been sent, we display the same values","\t\tif(isset($_POST['username'],$_POST['password'],$_POST['email']))","\t\t{","\t\t\t$pseudo = htmlentities($_POST['username'], ENT_QUOTES, 'UTF-8');","\t\t\tif($_POST['password']==$_POST['passverif'])","\t\t\t{","\t\t\t\t$password = htmlentities($_POST['password'], ENT_QUOTES, 'UTF-8');","\t\t\t}","\t\t\telse","\t\t\t{","\t\t\t\t$password = '';","\t\t\t}","\t\t\t$email = htmlentities($_POST['email'], ENT_QUOTES, 'UTF-8');","\t\t\t$avatar = htmlentities($_POST['avatar'], ENT_QUOTES, 'UTF-8');","\t\t}","\t\telse","\t\t{","\t\t\t//otherwise, we display the values of the database","\t\t\t$dnn = mysql_fetch_array(mysql_query('select username,password,email,avatar from users where username=\"'.$_SESSION['username'].'\"'));","\t\t\t$username = htmlentities($dnn['username'], ENT_QUOTES, 'UTF-8');","\t\t\t$password = htmlentities($dnn['password'], ENT_QUOTES, 'UTF-8');","\t\t\t$email = htmlentities($dnn['email'], ENT_QUOTES, 'UTF-8');","\t\t\t$avatar = htmlentities($dnn['avatar'], ENT_QUOTES, 'UTF-8');","\t\t}","\t\t//We display the form","?>","<div class=\"content\">","    <form action=\"edit_infos.php\" method=\"post\">","        You can edit your informations:<br />","        <div class=\"center\">","            <label for=\"username\">Username</label><input type=\"text\" name=\"username\" id=\"username\" value=\"<?php echo $username; ?>\" /><br />","            <label for=\"password\">Password<span class=\"small\">(6 characters min.)</span></label><input type=\"password\" name=\"password\" id=\"password\" value=\"<?php echo $password; ?>\" /><br />","            <label for=\"passverif\">Password<span class=\"small\">(verification)</span></label><input type=\"password\" name=\"passverif\" id=\"passverif\" value=\"<?php echo $password; ?>\" /><br />","            <label for=\"email\">Email</label><input type=\"text\" name=\"email\" id=\"email\" value=\"<?php echo $email; ?>\" /><br />","            <label for=\"avatar\">Avatar<span class=\"small\">(optional)</span></label><input type=\"text\" name=\"avatar\" id=\"avatar\" value=\"<?php echo $avatar; ?>\" /><br />","            <input type=\"submit\" value=\"Send\" />","        </div>","    </form>","</div>","<?php","\t}","}","else","{","?>","<div class=\"message\">To access this page, you must be logged.<br />","<a href=\"connexion.php\">Log in</a></div>","<?php","}","?>","\t\t<div class=\"foot\"><a href=\"<?php echo $url_home; ?>\">Go Home</a> - <a href=\"http://www.webestools.com/\">Webestools</a></div>","\t</body>","</html>"]}]}]]},"ace":{"folds":[],"scrolltop":1866,"scrollleft":0,"selection":{"start":{"row":159,"column":7},"end":{"row":159,"column":7},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":132,"state":"start","mode":"ace/mode/php"}},"timestamp":1418386784589,"hash":"ebcd74e19eac2ee4b8350a4f023cbc7e5daffd71"}